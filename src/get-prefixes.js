import fs from "node:fs";

async function getPrefixes() {
	let url = "https://api.fontawesome.com";

	let data = await fetch(url, {
		method: "post",
		body: JSON.stringify({
			"query": "query { release(version:\"6.x\"){ familyStyles { prefix family style } } }"
		}),
		headers: {
			"Content-Type": "application/json",
		},
	});

	let json = await data.json();
	// console.log( JSON.stringify(json, null, 2) );

	let familyStyleToPrefixMap = {};
	let prefixToFamilyStyleMap = {};
	let styles = new Set();
	let families = new Set();
	let prefixes = new Set();

	for(let {family, prefix, style} of json?.data?.release?.familyStyles || []) {
		styles.add(style);
		families.add(family);
		prefixes.add(prefix);

		if(!prefixToFamilyStyleMap[prefix]) {
			prefixToFamilyStyleMap[prefix] = {
				family,
				style,
			};
		}

		if(!familyStyleToPrefixMap[family]) {
			familyStyleToPrefixMap[family] = {};
		}
		if(!familyStyleToPrefixMap[family][style]) {
			familyStyleToPrefixMap[family][style] = prefix;
		}
	}

	return {
		prefixes: Array.from(prefixes),
		styles: Array.from(styles),
		families: Array.from(families),
		familyStyleToPrefixMap,
		prefixToFamilyStyleMap,
	};
};

let prefixes = await getPrefixes();
let filePath = "./src/prefixes.js";
fs.writeFileSync(filePath, `// Warning: this file is automatically generated by \`npm run update-prefixes\`
export default ${JSON.stringify(prefixes, null, 2)}`);
console.log( `Prefixes written to ${filePath}.` );